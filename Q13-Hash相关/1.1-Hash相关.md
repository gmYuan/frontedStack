## webpack常见配置

Q1.1 什么是 Hash, 它有什么作用

A: <br/>

1 形象化理解 <br/>

一种 “内容识别编号”，不同的内容会有不同对应的 编号


2 实际含义

2.1 Hash 是一个 将任意长度的数据，映射为固定长度的字符串的 过程

它一般用于 区分文件是否相同, 从而实现 文件的缓存


2.2 技术原理
  - 使用确定性的哈希算法（如 MD4/MD5）
  - 基于文件内容，生成唯一的标识符
  - 输出固定长度的 Hash 字符串

2.3 Hash 的特点
  - 确定性：相同输入 产生 相同输出
  - 不可逆：无法从Hash值 反推原始内容
  - 雪崩效应：输入小改动 会导致 Hash值 大变化


2.4 Hash示例

```js
// 没有使用 Hash的 打包文件
main.js
styles.css


// 使用 Hash后的 打包文件
main.a7c92f56.js
styles.b8d33c89.css
```


3 作用

3.1 解决 浏览器缓存问题
  - 浏览器会缓存静态资源
  - 当文件更新时，Hash 改变 导致文件名变化
  - 从而 强制浏览器 重新下载新文件

3.2 版本管理
  - 不同版本的文件，有不同的 Hash
  - 便于 追踪和定位问题
  - 支持 多版本并存

3.3 优化网络性能
  - 未改变的文件 Hash 保持不变，继续使用缓存
  - 只下载发生变化的文件
  - 提升 加载速度 和 用户体验


---------------------------------------------------------------
Q2.1 webpack 如果使用了 hash 命名，是否每次都会重新生成 hash？

A: <br/>

1 这取决于 使用的是 哪种 hash 策略

2 Webpack 提供了3种 hash 策略，每种都有 不同的生成规则:

2.1 hash: 项目级别的 hash
  - 特点：每次构建 都会生成新的 hash，不管内容是否发生变化

```js
// 第一次构建
main.abc123.js
styles.abc123.css
  
// 第二次构建（即使文件内容没变）
main.def456.js
styles.def456.css
```

2.2 chunkhash: 基于 chunk内容 生成hash
  - 不同的 entry 会⽣成不同的 chunkhash 值
  - 特点：只有当 chunk 内容变化时, 才会生成新的 hash
 

```js
// 初始构建
main.abc123.js      // 入口1
vendor.def456.js    // 入口2
  
// 修改了 main.js 后构建
main.xyz789.js      // hash 改变
vendor.def456.js    // hash 不变
```

2.3 contenthash: 基于 文件内容 生成hash
  - 特点：只有当文件内容变化时，才会生成 新的hash

```js
// 初始构建
main.abc123.js
styles.def456.css
  
// 只修改了 js 后构建
main.xyz789.js      // hash 改变
styles.def456.css   // hash 不变
```

所以 【不一定 每次都会 重新生成hash】，这取决于
  - 选择的 hash 策略
  - 文件内容 是否发生变化
  - 是否处于 开发环境 或 生产环境


----------------------------------------------
Q2.2 Hash 在前端的主要使用场景是什么

A: <br/>

1 在前端开发中，Hash 主要解决以下问题:

1.1 解决 页面刷新缓存问题
  - 场景：网站发布新版本后，用户访问时总是看到旧页面
  - 原因：浏览器使用了缓存的旧文件
  - 解决：文件名带上 Hash，内容更新时 Hash 改变，强制浏览器下载新文件

```html
<!-- 旧版本 -->
<script src="main.js"></script>
<link href="style.css" rel="stylesheet">

<!-- 新版本：使用 Hash 后 -->
<script src="main.a7c92f56.js"></script>
<link href="style.b8d33c89.css" rel="stylesheet">
```


1.2 优化更新体验
  - 场景：修改了一个小功能，但用户要重新下载所有文件
  - 解决：使用 contenthash，只有改动的文件才会生成新的 Hash
  - 好处：用户只需下载更新的文件，其他文件继续使用缓存

```js
// 只有修改过的文件才会改变 Hash
main.a7c92f56.js     // 已修改，Hash 改变
vendor.e7d9cb32.js   // 未修改，Hash 保持不变
```


1.3 配合 CDN 使用

1.3.1 多版本共存：
  - 带 hash 的文件可以设置永久缓存
  - 因为文件内容变化时，hash 会变，生成新的文件名
  - 旧文件还保留在 CDN 上，保证正在访问的用户不受影响
  - 新旧版本可以同时存在==> 方便进行灰度发布 + 有问题可以快速回滚

```bash
  cdn.example.com/assets/
    ├── main.a7c92f56.js  # 旧版本
    └── main.b8d33c89.js  # 新版本
```


1.3.2 CDN 回源和刷新：
  - 回源：当 CDN 上没有用户请求的文件时，会向源站请求
  - 由于使用 hash，新文件名一定不同，必然会触发回源
  - 不需要手动刷新 CDN 缓存

基本配置示例：

```js
// webpack.config.js
module.exports = {
  output: {
    // 指定 CDN 的基础路径
    publicPath: 'https://cdn.example.com/assets/',
    // 生成带 hash 的文件名
    filename: '[name].[contenthash:8].js'
  }
}
```

```html
<!-- 实际效果 -->

<!-- 构建前的源代码 -->
<script src="main.js"></script>

<!-- 构建后实际在浏览器中的代码 -->
<script src="https://cdn.example.com/assets/main.a7c92f56.js"></script>
```

